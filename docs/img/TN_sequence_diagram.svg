<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1514px" preserveAspectRatio="none" style="width:1205px;height:1514px;background:#FFFFFF;" version="1.1" viewBox="0 0 1205 1514" width="1205px" zoomAndPan="magnify"><defs><filter height="300%" id="fvtxd3xmbgtbg" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#ADD8E6" filter="url(#fvtxd3xmbgtbg)" height="666.957" style="stroke:#A80036;stroke-width:1.0;" width="10" x="187.5" y="175.1289"/><rect fill="#ADD8E6" filter="url(#fvtxd3xmbgtbg)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="192.5" y="499.8906"/><rect fill="#ADD8E6" filter="url(#fvtxd3xmbgtbg)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="192.5" y="643.2891"/><rect fill="#ADD8E6" filter="url(#fvtxd3xmbgtbg)" height="334.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="187.5" y="919.3516"/><rect fill="#EE82EE" filter="url(#fvtxd3xmbgtbg)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="555.5" y="312.2266"/><rect fill="#EE82EE" filter="url(#fvtxd3xmbgtbg)" height="272.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="555.5" y="470.7578"/><rect fill="#ADD8E6" filter="url(#fvtxd3xmbgtbg)" height="520.8594" style="stroke:#A80036;stroke-width:1.0;" width="10" x="917.5" y="258.9609"/><rect fill="#ADD8E6" filter="url(#fvtxd3xmbgtbg)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="917.5" y="1052.8828"/><rect fill="#ADD8E6" filter="url(#fvtxd3xmbgtbg)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="917.5" y="1153.2813"/><rect fill="#ADD8E6" filter="url(#fvtxd3xmbgtbg)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="917.5" y="1311.9453"/><rect fill="#FFFFFF" filter="url(#fvtxd3xmbgtbg)" height="477.7266" style="stroke:#000000;stroke-width:2.0;" width="1019.5" x="142" y="273.9609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="38" x2="38" y1="88.2969" y2="1430.3438"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="192" x2="192" y1="88.2969" y2="1430.3438"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="560" x2="560" y1="88.2969" y2="1430.3438"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="922" x2="922" y1="88.2969" y2="1430.3438"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1161" x2="1161" y1="88.2969" y2="1430.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="5" y="84.9951">aliceSAE</text><ellipse cx="38.5" cy="15" fill="#F08080" filter="url(#fvtxd3xmbgtbg)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M38.5,23 L38.5,50 M25.5,31 L51.5,31 M38.5,50 L25.5,65 M38.5,50 L51.5,65 " fill="none" filter="url(#fvtxd3xmbgtbg)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="5" y="1442.3389">aliceSAE</text><ellipse cx="38.5" cy="1455.6406" fill="#F08080" filter="url(#fvtxd3xmbgtbg)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M38.5,1463.6406 L38.5,1490.6406 M25.5,1471.6406 L51.5,1471.6406 M38.5,1490.6406 L25.5,1505.6406 M38.5,1490.6406 L51.5,1505.6406 " fill="none" filter="url(#fvtxd3xmbgtbg)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#ADD8E6" filter="url(#fvtxd3xmbgtbg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="77" x="152" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63" x="159" y="72.9951">aliceQKS</text><rect fill="#ADD8E6" filter="url(#fvtxd3xmbgtbg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="77" x="152" y="1429.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63" x="159" y="1449.3389">aliceQKS</text><rect fill="#EE82EE" filter="url(#fvtxd3xmbgtbg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="79" x="519" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="526" y="72.9951">carolQKS</text><rect fill="#EE82EE" filter="url(#fvtxd3xmbgtbg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="79" x="519" y="1429.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="526" y="1449.3389">carolQKS</text><rect fill="#ADD8E6" filter="url(#fvtxd3xmbgtbg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="73" x="884" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="891" y="72.9951">bobQKS</text><rect fill="#ADD8E6" filter="url(#fvtxd3xmbgtbg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="73" x="884" y="1429.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="891" y="1449.3389">bobQKS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="1130" y="84.9951">bobSAE</text><ellipse cx="1161.5" cy="15" fill="#F08080" filter="url(#fvtxd3xmbgtbg)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M1161.5,23 L1161.5,50 M1148.5,31 L1174.5,31 M1161.5,50 L1148.5,65 M1161.5,50 L1174.5,65 " fill="none" filter="url(#fvtxd3xmbgtbg)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="1130" y="1442.3389">bobSAE</text><ellipse cx="1161.5" cy="1455.6406" fill="#F08080" filter="url(#fvtxd3xmbgtbg)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M1161.5,1463.6406 L1161.5,1490.6406 M1148.5,1471.6406 L1174.5,1471.6406 M1161.5,1490.6406 L1148.5,1505.6406 M1161.5,1490.6406 L1174.5,1505.6406 " fill="none" filter="url(#fvtxd3xmbgtbg)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#ADD8E6" filter="url(#fvtxd3xmbgtbg)" height="666.957" style="stroke:#A80036;stroke-width:1.0;" width="10" x="187.5" y="175.1289"/><rect fill="#ADD8E6" filter="url(#fvtxd3xmbgtbg)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="192.5" y="499.8906"/><rect fill="#ADD8E6" filter="url(#fvtxd3xmbgtbg)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="192.5" y="643.2891"/><rect fill="#ADD8E6" filter="url(#fvtxd3xmbgtbg)" height="334.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="187.5" y="919.3516"/><rect fill="#EE82EE" filter="url(#fvtxd3xmbgtbg)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="555.5" y="312.2266"/><rect fill="#EE82EE" filter="url(#fvtxd3xmbgtbg)" height="272.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="555.5" y="470.7578"/><rect fill="#ADD8E6" filter="url(#fvtxd3xmbgtbg)" height="520.8594" style="stroke:#A80036;stroke-width:1.0;" width="10" x="917.5" y="258.9609"/><rect fill="#ADD8E6" filter="url(#fvtxd3xmbgtbg)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="917.5" y="1052.8828"/><rect fill="#ADD8E6" filter="url(#fvtxd3xmbgtbg)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="917.5" y="1153.2813"/><rect fill="#ADD8E6" filter="url(#fvtxd3xmbgtbg)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="917.5" y="1311.9453"/><rect fill="#EEEEEE" filter="url(#fvtxd3xmbgtbg)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1198" x="0" y="118.8633"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1198" y1="118.8633" y2="118.8633"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1198" y1="121.8633" y2="121.8633"/><rect fill="#EEEEEE" filter="url(#fvtxd3xmbgtbg)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="186" x="506" y="108.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167" x="512" y="124.3638">Indirect stream setup</text><polygon fill="#0000FF" points="175.5,171.1289,185.5,175.1289,175.5,179.1289,179.5,175.1289" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="38.5" x2="181.5" y1="175.1289" y2="175.1289"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="45.5" y="170.063">getStatus (bobSAE)</text><path d="M202,146.4297 L202,186.4297 L426,186.4297 L426,156.4297 L416,146.4297 L202,146.4297 " fill="#FBFB77" filter="url(#fvtxd3xmbgtbg)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M416,146.4297 L416,156.4297 L426,156.4297 L416,146.4297 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="208" y="163.4966">bobSAE non directly connected</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="212" y="178.6294">keyStream not found</text><ellipse cx="197" cy="229.0781" rx="4" ry="4" style="stroke:#0000FF;stroke-width:1.5;fill:none;"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="197.5" x2="239.5" y1="216.8281" y2="216.8281"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="239.5" x2="239.5" y1="216.8281" y2="229.8281"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="202.5" x2="239.5" y1="229.8281" y2="229.8281"/><polygon fill="#0000FF" points="212.5,225.8281,202.5,229.8281,212.5,233.8281,208.5,229.8281" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="204.5" y="211.7622">generates KSID_AB</text><polygon fill="#0000FF" points="905.5,254.9609,915.5,258.9609,905.5,262.9609,909.5,258.9609" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="197.5" x2="911.5" y1="258.9609" y2="258.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="298" x="204.5" y="253.895">createStream (server_src, KSID_AB, keyID_AB)</text><path d="M142,273.9609 L270,273.9609 L270,280.9609 L260,290.9609 L142,290.9609 L142,273.9609 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="477.7266" style="stroke:#000000;stroke-width:2.0;" width="1019.5" x="142" y="273.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="83" x="157" y="287.0278">forwarding</text><ellipse cx="565" cy="311.4766" rx="4" ry="4" style="stroke:#4B0082;stroke-width:1.5;fill:none;"/><polygon fill="#4B0082" points="582,308.2266,572,312.2266,582,316.2266,578,312.2266" style="stroke:#4B0082;stroke-width:1.0;"/><ellipse cx="917" cy="311.4766" rx="4" ry="4" style="stroke:#4B0082;stroke-width:1.5;fill:none;"/><polygon fill="#4B0082" points="900,308.2266,910,312.2266,900,316.2266,904,312.2266" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="580" x2="906" y1="312.2266" y2="312.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="582.5" y="307.1606">Exchange a key (key_BC) as in PTP</text><ellipse cx="927" cy="398.7422" rx="4" ry="4" style="stroke:#0000FF;stroke-width:1.5;fill:none;"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="927.5" x2="969.5" y1="386.4922" y2="386.4922"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="969.5" x2="969.5" y1="386.4922" y2="399.4922"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="932.5" x2="969.5" y1="399.4922" y2="399.4922"/><polygon fill="#0000FF" points="942.5,395.4922,932.5,399.4922,942.5,403.4922,938.5,399.4922" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="934.5" y="366.2935">generates key_AB, keyID_AB</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="938.5" y="381.4263">and save in vault</text><ellipse cx="927" cy="440.875" rx="4" ry="4" style="stroke:#0000FF;stroke-width:1.5;fill:none;"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="927.5" x2="969.5" y1="428.625" y2="428.625"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="969.5" x2="969.5" y1="428.625" y2="441.625"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="932.5" x2="969.5" y1="441.625" y2="441.625"/><polygon fill="#0000FF" points="942.5,437.625,932.5,441.625,942.5,445.625,938.5,441.625" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="934.5" y="423.5591">enc((key_AB+keyID_AB), key_BC)</text><polygon fill="#4B0082" points="576.5,466.7578,566.5,470.7578,576.5,474.7578,572.5,470.7578" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.0;" x1="570.5" x2="916.5" y1="470.7578" y2="470.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="333" x="582.5" y="465.6919">forwardData (enc_data, boBQKS, aliceKS, keyID_BC)</text><ellipse cx="202" cy="499.1406" rx="4" ry="4" style="stroke:#4B0082;stroke-width:1.5;fill:none;"/><polygon fill="#4B0082" points="219,495.8906,209,499.8906,219,503.8906,215,499.8906" style="stroke:#4B0082;stroke-width:1.0;"/><ellipse cx="555" cy="499.1406" rx="4" ry="4" style="stroke:#4B0082;stroke-width:1.5;fill:none;"/><polygon fill="#4B0082" points="538,495.8906,548,499.8906,538,503.8906,542,499.8906" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="217" x2="544" y1="499.8906" y2="499.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="219.5" y="494.8247">Exhcange a key (key_AC) as in PTP</text><ellipse cx="565" cy="571.2734" rx="4" ry="4" style="stroke:#4B0082;stroke-width:1.5;fill:none;"/><line style="stroke:#4B0082;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="565.5" x2="607.5" y1="559.0234" y2="559.0234"/><line style="stroke:#4B0082;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="607.5" x2="607.5" y1="559.0234" y2="572.0234"/><line style="stroke:#4B0082;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="570.5" x2="607.5" y1="572.0234" y2="572.0234"/><polygon fill="#4B0082" points="580.5,568.0234,570.5,572.0234,580.5,576.0234,576.5,572.0234" style="stroke:#4B0082;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="572.5" y="553.9575">dec(enc_data, key_BC)</text><ellipse cx="565" cy="613.4063" rx="4" ry="4" style="stroke:#4B0082;stroke-width:1.5;fill:none;"/><line style="stroke:#4B0082;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="565.5" x2="607.5" y1="601.1563" y2="601.1563"/><line style="stroke:#4B0082;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="607.5" x2="607.5" y1="601.1563" y2="614.1563"/><line style="stroke:#4B0082;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="570.5" x2="607.5" y1="614.1563" y2="614.1563"/><polygon fill="#4B0082" points="580.5,610.1563,570.5,614.1563,580.5,618.1563,576.5,614.1563" style="stroke:#4B0082;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="572.5" y="596.0903">enc(dec_data, key_AC)</text><polygon fill="#0000FF" points="213.5,639.2891,203.5,643.2891,213.5,647.2891,209.5,643.2891" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="207.5" x2="554.5" y1="643.2891" y2="643.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="219.5" y="638.2231">forwardData (enc_data, boBQKS, aliceKS, keyID_AC)</text><ellipse cx="202" cy="684.6719" rx="4" ry="4" style="stroke:#0000FF;stroke-width:1.5;fill:none;"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="202.5" x2="244.5" y1="672.4219" y2="672.4219"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="244.5" x2="244.5" y1="672.4219" y2="685.4219"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="207.5" x2="244.5" y1="685.4219" y2="685.4219"/><polygon fill="#0000FF" points="217.5,681.4219,207.5,685.4219,217.5,689.4219,213.5,685.4219" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="209.5" y="667.356">save key_AB in vault</text><polygon fill="#4B0082" points="543.5,710.5547,553.5,714.5547,543.5,718.5547,547.5,714.5547" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="197.5" x2="549.5" y1="714.5547" y2="714.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="204.5" y="709.4888">&lt; ACK_forwarding &gt;</text><polygon fill="#4B0082" points="905.5,739.6875,915.5,743.6875,905.5,747.6875,909.5,743.6875" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="560.5" x2="911.5" y1="743.6875" y2="743.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="567.5" y="738.6216">&lt; ACK_forwarding &gt;</text><polygon fill="#0000FF" points="208.5,775.8203,198.5,779.8203,208.5,783.8203,204.5,779.8203" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="202.5" x2="921.5" y1="779.8203" y2="779.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="214.5" y="774.7544">&lt; ACK open_stream &gt;</text><polygon fill="#FBFB77" filter="url(#fvtxd3xmbgtbg)" points="165,792.8203,949,792.8203,959,803.8203,949,815.8203,165,815.8203,155,803.8203,165,792.8203" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="427" y="808.8872">now AliceQKS and BobQKS share key_AB</text><polygon fill="#0000FF" points="49.5,838.0859,39.5,842.0859,49.5,846.0859,45.5,842.0859" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="43.5" x2="191.5" y1="842.0859" y2="842.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="55.5" y="837.02">&lt; info &gt;</text><rect fill="#EEEEEE" filter="url(#fvtxd3xmbgtbg)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1198" x="0" y="870.6523"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1198" y1="870.6523" y2="870.6523"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1198" y1="873.6523" y2="873.6523"/><rect fill="#EEEEEE" filter="url(#fvtxd3xmbgtbg)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="230" x="484" y="860.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="211" x="490" y="876.1528">SAE Key Exchange (Indirect)</text><polygon fill="#0000FF" points="175.5,915.3516,185.5,919.3516,175.5,923.3516,179.5,919.3516" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="38.5" x2="181.5" y1="919.3516" y2="919.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="45.5" y="914.2856">getKey(bobSAE)</text><path d="M202,898.2188 L202,923.2188 L320,923.2188 L320,908.2188 L310,898.2188 L202,898.2188 " fill="#FBFB77" filter="url(#fvtxd3xmbgtbg)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M310,898.2188 L310,908.2188 L320,908.2188 L310,898.2188 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="208" y="915.2856">indirect stream</text><ellipse cx="197" cy="980.8672" rx="4" ry="4" style="stroke:#0000FF;stroke-width:1.5;fill:none;"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="197.5" x2="239.5" y1="968.6172" y2="968.6172"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="239.5" x2="239.5" y1="968.6172" y2="981.6172"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="202.5" x2="239.5" y1="981.6172" y2="981.6172"/><polygon fill="#0000FF" points="212.5,977.6172,202.5,981.6172,212.5,985.6172,208.5,981.6172" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="204.5" y="948.4185">generates key_S, keyID_S</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="208.5" y="963.5513">and save in vault</text><ellipse cx="197" cy="1023" rx="4" ry="4" style="stroke:#0000FF;stroke-width:1.5;fill:none;"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="197.5" x2="239.5" y1="1010.75" y2="1010.75"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="239.5" x2="239.5" y1="1010.75" y2="1023.75"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="202.5" x2="239.5" y1="1023.75" y2="1023.75"/><polygon fill="#0000FF" points="212.5,1019.75,202.5,1023.75,212.5,1027.75,208.5,1023.75" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="204.5" y="1005.6841">enc((keyS+keyID_S), key_AB)</text><polygon fill="#0000FF" points="905.5,1048.8828,915.5,1052.8828,905.5,1056.8828,909.5,1052.8828" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="197.5" x2="911.5" y1="1052.8828" y2="1052.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326" x="204.5" y="1047.8169">forwardKey (enc_data, aliceKS, boBQKS, keyID_AB)</text><ellipse cx="927" cy="1094.2656" rx="4" ry="4" style="stroke:#0000FF;stroke-width:1.5;fill:none;"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="927.5" x2="969.5" y1="1082.0156" y2="1082.0156"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="969.5" x2="969.5" y1="1082.0156" y2="1095.0156"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="932.5" x2="969.5" y1="1095.0156" y2="1095.0156"/><polygon fill="#0000FF" points="942.5,1091.0156,932.5,1095.0156,942.5,1099.0156,938.5,1095.0156" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="934.5" y="1076.9497">save key_S in vault</text><polygon fill="#0000FF" points="208.5,1120.1484,198.5,1124.1484,208.5,1128.1484,204.5,1124.1484" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="202.5" x2="921.5" y1="1124.1484" y2="1124.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="214.5" y="1119.0825">&lt; ACK_forwarding &gt;</text><polygon fill="#0000FF" points="905.5,1149.2813,915.5,1153.2813,905.5,1157.2813,909.5,1153.2813" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="197.5" x2="911.5" y1="1153.2813" y2="1153.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="204.5" y="1148.2153">reserveKey (keyID_S)</text><polygon fill="#0000FF" points="208.5,1178.4141,198.5,1182.4141,208.5,1186.4141,204.5,1182.4141" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="202.5" x2="921.5" y1="1182.4141" y2="1182.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="214.5" y="1177.3481">&lt; ACK_reserve &gt;</text><ellipse cx="197" cy="1223.7969" rx="4" ry="4" style="stroke:#0000FF;stroke-width:1.5;fill:none;"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="197.5" x2="239.5" y1="1211.5469" y2="1211.5469"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="239.5" x2="239.5" y1="1211.5469" y2="1224.5469"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="202.5" x2="239.5" y1="1224.5469" y2="1224.5469"/><polygon fill="#0000FF" points="212.5,1220.5469,202.5,1224.5469,212.5,1228.5469,208.5,1224.5469" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="204.5" y="1206.481">retrieve key_S from vault</text><polygon fill="#0000FF" points="49.5,1249.6797,39.5,1253.6797,49.5,1257.6797,45.5,1253.6797" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="43.5" x2="191.5" y1="1253.6797" y2="1253.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="55.5" y="1248.6138">&lt; keyID_S, key_S &gt;</text><polygon fill="#FF0000" points="1149.5,1278.8125,1159.5,1282.8125,1149.5,1286.8125,1153.5,1282.8125" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="38.5" x2="1155.5" y1="1282.8125" y2="1282.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="45.5" y="1277.7466">send keyID_S</text><polygon fill="#0000FF" points="938.5,1307.9453,928.5,1311.9453,938.5,1315.9453,934.5,1311.9453" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="932.5" x2="1160.5" y1="1311.9453" y2="1311.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="944.5" y="1306.8794">getKeyWithID(keyID_S)</text><ellipse cx="927" cy="1353.3281" rx="4" ry="4" style="stroke:#0000FF;stroke-width:1.5;fill:none;"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="927.5" x2="969.5" y1="1341.0781" y2="1341.0781"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="969.5" x2="969.5" y1="1341.0781" y2="1354.0781"/><line style="stroke:#0000FF;stroke-width:1.0;fill:none;stroke-dasharray:2.0,2.0;" x1="932.5" x2="969.5" y1="1354.0781" y2="1354.0781"/><polygon fill="#0000FF" points="942.5,1350.0781,932.5,1354.0781,942.5,1358.0781,938.5,1354.0781" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="934.5" y="1336.0122">retrieve key_S from vault</text><polygon fill="#0000FF" points="1149.5,1379.2109,1159.5,1383.2109,1149.5,1387.2109,1153.5,1383.2109" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="922.5" x2="1155.5" y1="1383.2109" y2="1383.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="929.5" y="1378.145">&lt; keyID_S, key_S &gt;</text><polygon fill="#FF0000" points="49.5,1408.3438,39.5,1412.3438,49.5,1416.3438,45.5,1412.3438" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="1149.5,1408.3438,1159.5,1412.3438,1149.5,1416.3438,1153.5,1412.3438" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="43.5" x2="1155.5" y1="1412.3438" y2="1412.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="55.5" y="1407.2778">&lt; can communicate securely &gt;</text><!--MD5=[d0a4d75dfc8d545da646d64f34aba6a4]
@startuml
actor aliceSAE as ASAE order 1  #lightCoral
actor bobSAE as BSAE order 5  #lightCoral
participant aliceQKS as AQKS order 2 #LightBlue
participant bobQKS as BQKS order 4 #LightBlue
participant carolQKS as CQKS order 3 #violet


== Indirect stream setup == 
ASAE -[#blue]> AQKS : getStatus (bobSAE)
activate AQKS #LightBlue
note right: bobSAE non directly connected \n keyStream not found 
AQKS -[#blue]->o AQKS : generates KSID_AB
AQKS -[#blue]> BQKS : createStream (server_src, KSID_AB, keyID_AB)
activate BQKS #LightBlue

group forwarding
BQKS o<-[#indigo]->o CQKS :  Exchange a key (key_BC) as in PTP
activate CQKS #violet
deactivate CQKS 
BQKS -[#blue]->o BQKS : generates key_AB, keyID_AB \n and save in vault
BQKS -[#blue]->o BQKS : enc((key_AB+keyID_AB), key_BC)
BQKS -[#indigo]> CQKS : forwardData (enc_data, boBQKS, aliceKS, keyID_BC) 
activate CQKS #violet

CQKS o<-[#indigo]->o AQKS : Exhcange a key (key_AC) as in PTP
activate AQKS #LightBlue
deactivate AQKS
CQKS -[#indigo]->o CQKS : dec(enc_data, key_BC)
CQKS -[#indigo]->o CQKS : enc(dec_data, key_AC)
CQKS -[#blue]> AQKS : forwardData (enc_data, boBQKS, aliceKS, keyID_AC) 
activate AQKS #LightBlue
AQKS -[#blue]->o AQKS : save key_AB in vault
AQKS -[#indigo]-> CQKS : < ACK_forwarding >
deactivate AQKS 
CQKS -[#indigo]-> BQKS : < ACK_forwarding >
deactivate CQKS
end

BQKS -[#blue]-> AQKS : < ACK open_stream > 
deactivate BQKS
hnote over AQKS,BQKS : now AliceQKS and BobQKS share key_AB 
AQKS -[#blue]-> ASAE : < info >
deactivate AQKS


== SAE Key Exchange (Indirect) == 

ASAE -[#blue]> AQKS : getKey(bobSAE) 
activate AQKS #LightBlue
note right: indirect stream
AQKS -[#blue]->o AQKS : generates key_S, keyID_S \n and save in vault
AQKS -[#blue]->o AQKS : enc((keyS+keyID_S), key_AB)
AQKS -[#blue]> BQKS : forwardKey (enc_data, aliceKS, boBQKS, keyID_AB)  
activate BQKS #LightBlue
BQKS -[#blue]->o BQKS :save key_S in vault
BQKS -[#blue]-> AQKS : < ACK_forwarding >
deactivate BQKS
AQKS -[#blue]> BQKS : reserveKey (keyID_S)
activate BQKS #LightBlue
BQKS -[#blue]-> AQKS : < ACK_reserve >
deactivate BQKS
AQKS -[#blue]->o AQKS : retrieve key_S from vault
AQKS -[#blue]-> ASAE : < keyID_S, key_S >
deactivate AQKS
ASAE -[#red]> BSAE : send keyID_S
BSAE -[#blue]> BQKS : getKeyWithID(keyID_S)
activate BQKS #LightBlue
BQKS -[#blue]->o BQKS : retrieve key_S from vault
BQKS -[#blue]-> BSAE : < keyID_S, key_S >
deactivate BQKS
ASAE <-[#red]> BSAE : < can communicate securely >
@enduml

PlantUML version 1.2021.7beta2(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>